---
title: "[iOS] FDLog App客户端日志系统"
catalog: true
toc_nav_num: true
date: 2019-04-10 09:04:30
subtitle: "如何实现一个高性能的App日志系统"
header-img: "https://raw.githubusercontent.com/zColdWater/Resources/master/Images/camper.jpg"
tags:
- iOS
catagories:
- iOS
---

背景
=======
> 背景概述: App端经常会遇到线上业务出问题的情况，想分析具体是哪块的问题，但是如果没有日志系统的支持，就很难定位客户App的实际情况，很难找到实际的原因，所以在这个背景下，我们必须要有一套，好用并且性能较好的系统来帮助我们。



简述
=======

**App端日志实现的基本要素:**

1. 安全
    * 当我们在代码里面写入一行一行的日志的时候，并不能明文存在我们的手机中，如果有拿到手机ROOT权限的人，有意搜索相关有用的信息时，就会发现日志信息并且明文，那么公司的一些业务信息就会暴露等，所以一定要保证安全。
2. 性能
    * App属于前端的范畴，性能也是一个App能否留住用户的关键，当日志系统性能太差，经常会大比例的占用CPU等，影响到渲染的时候，就需要考虑这个日志的设计是否合理了。
3. 丢失率
    * 日志的丢失率也是我们需要考虑的，当正在执行日志记录的情景下，突然被用户杀掉是否影响之前记录的日志信息，最大程度上的降低丢失率。


**日志的上报策略:**

1. 轮询
    * 通过定时任务不断上传App日志，这样可以利用的数据就会很多，数据分析团队，会根据前端上报的日志快速报警，在用户没有主动联系我们的时候，我们就可以定位到问题，并且诊断修复它。
2. 引导用户
    * 如果觉得业务日志信息大批量上报，我们只想要出问题的日志进行排查，也可以在App内有一个地方是专门上报日志的触发按钮，当用户觉得App出现了问题，他会联系客服，在客服的引导下上报日志，开发查看问题。
3. 日志回捞
    * 用户将自己身份信息（例如 用户名/ID）告知客服，客服将关键信息给到开发小哥，开发小哥通过日志系统，日志回捞，将目标用户的本地日志上传到服务器进行诊断，其实相比于引导用户来上报，就是降低了用户的操作步骤。


